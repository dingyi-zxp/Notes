# TCP
 > TCP Transmission Control Protocol 传输控制协议；面向连接的协议，在收发数据前需要建立可靠连接。 
> TCP连接需要经历三次对话才能建立。
> TCP 协议是一种面向连接的、可靠的、基于数字流 的运输层网络协议，TCP是全双工模式 ，所以需
要四次挥手来关闭连接。

## TCP包首部 
网络传输数据包由两部分部分组成                                                                  

1. 协议所要用到的首部，标明协议应该如何读取数据。 
2. 另一部分是上层串来的数据。                    


![TCP header](https://static.coonote.com/v2-2aa192d35fb785d6ff699035d060dc47_1440w.jpg)         
![](https://static.coonote.com/20180520124426161.jpg)

### TCP头部说明
- 源端口和目的端口：**各占2字节** 端口是传输层与应用层的服务接口，传输层的复用和分用功能都要通过端口才能实现；
- 序号：占**4字节** 。TCP连接中传送的数据流中的每一个字节都编上一个序号。序号字段的值则指的是报文段**所发送的数据的第一字节的序号** ；
- 确认号：**4字节** 。期望收到对方的下一个报文段的数据的第一个字节序号。
- 数据偏移/首部长度：4字节。指出TCP报文段的数据起始处距离TCP报文段的起始处有多少bit。“数据偏移”的单位是32位字。
- 保留：6位。保留为今后使用，
- 紧急URG：URG=1表明紧急字段有效，让系统知道此报文段有紧急数据，尽快传输（相当于高优先级的数据
- 确认ACK：ACK=1时确认号字段才有效；ACK=0时，确认号无效
- PSH（Push：接收TCP收到PSH=1的报文段，就会尽快地交付应用进程，而不再等到整个缓存都填满后再向上交付
- RST（ReSeT：当RST=1时，表明TCP连接中出现严重差错，必须释放连接，然后重新建立运输连接
- 同步SYN：SYN=1表示这是一个连接请求或连接接受报文
- 终止FIN：用来释放一个连接。FIN=1表明此报文段的发送端的数据已经发送完毕，并要求释放运输连接
- 检验和：2字段。检验和字段检验的范围包括首部和数据两部分。计算检验和时，要在TCP报文段的前面加上12字节的伪首部
- 紧急指针：占16位，指出在报文段中紧急数据共有多少字节（紧急数据在报文数据的最前面
- 选项：长度可变。TCP最初只规定一种选项，即最大报文长度MSS。MSS 告诉对方 TCP：“我的缓存所能接收的报文段的数据字段的最大长度是 MSS 个字节.” [MSS(Maximum Segment Size)是 TCP 报文段中的数据字段的最大长度.数据字段加上 TCP 首部才等于整个的 TCP 报文段]
- 填充：为了使整个首部长度是4字节的整数倍
- 其他选项：
	- 窗口扩大：3字节。其中有一个字节表示移位值S。新的窗口值等于TCP首部中的窗口位数增大到（16+S，相当于把窗口值左移动S位后获取实际窗口大小
	- 时间戳：占10字节，其中最主要的字段时间戳字节（4字节和时间戳回送回答字段（4字段
	- 选择确认：接收方收到了和前面的字节流不断的2字节。如果这些字节的序号都在接收窗口之内，那么接受者就先手下这些数据，但要把这些信息准确地告诉发送，使发送方不要再重复发送这些已收到的数据。


#### 重点介绍
1. 序号：seq序号，32位，用来表示从TCP源端向目的端发送的字节流，发起方发送数据时对此进行标记。
2. 确认序号： ack序号，32位，只有ACK标志位1时，确认序号才有效，ack=seq+1
3. 标识为：共6个
	1. ACK:确认序号有效
	2. FIN：释放一个连接
	3. PSH：接收方应该尽快将这个报文交给应用层
	4. RST：重置连接
	5. SYN：发起一个新连接
	6. URP：紧急指针（urgent pointer
	
**注意** 

不要将确认序号ack与标志位重点 ACK搞混了。
确认方ack发起方seq+1，两端配对。
## 三次对话 
